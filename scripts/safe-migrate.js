const { execSync } = require('child_process');
const fs = require('fs');
const path = require('path');

console.log('ğŸ”„ å®‰å…¨ãªãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹å§‹ã—ã¾ã™...');

try {
  // 1. ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
  console.log('ğŸ“¦ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¸­...');
  execSync('npm run db:backup', { stdio: 'inherit' });

  // 2. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Ÿè¡Œ
  console.log('ğŸš€ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œä¸­...');
  execSync('npx prisma migrate deploy', { stdio: 'inherit' });

  // 3. Prismaã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®å†ç”Ÿæˆ
  console.log('ğŸ”§ Prismaã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’å†ç”Ÿæˆä¸­...');
  execSync('npx prisma generate', { stdio: 'inherit' });

  console.log('âœ… ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸï¼');

} catch (error) {
  console.error('âŒ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ:', error.message);
  
  // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã®å¾©å…ƒã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æç¤º
  console.log('\nğŸ’¡ å¾©å…ƒã™ã‚‹å ´åˆã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„:');
  console.log('npm run db:restore <æœ€æ–°ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«å>');
  
  process.exit(1);
} 